<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="dto.Product" %>
<%@ page import="dto.ProductRepository" %>
<%@page import="com.oreilly.servlet.*" %>
<%@page import="com.oreilly.servlet.multipart.*" %>
<%@page import="java.util.*" %>



		<%
			request.setCharacterEncoding("UTF-8");	
		
			String filename ="";
			String save = request.getServletContext().getRealPath("./resources/images");
			String realFolder = save;
			int maxSize = 5*1024*1024;
			String encType = "utf-8";
			
			MultipartRequest multi = new MultipartRequest(
					request,
					realFolder,
					maxSize,
					encType,
					new DefaultFileRenamePolicy());
		
			String productId = multi.getParameter("productId");
			String name= multi.getParameter("name");
			String unitprice = multi.getParameter("unitprice");
			String description = multi.getParameter("description");
			String manufacturer = multi.getParameter("manufacturer");
			String category = multi.getParameter("category");
			String unitsinstock = multi.getParameter("unitsinstock");
			String condition = multi.getParameter("condition");
			
			Integer price;
			
			if(unitprice.isEmpty())
				price = 0;
			else
				price = Integer.valueOf(unitprice);
			
 	
			long stock;
			
			if(unitsinstock.isEmpty())
				stock =0;
			else
				stock=Long.valueOf(unitsinstock); 
			
			Enumeration files = multi.getFileNames();
			String fname = (String) files.nextElement();
			String fileName = multi.getFilesystemName(fname);
			
			ProductRepository dto = ProductRepository.getInstance();
			
			Product newProduct = new Product();
			newProduct.setProductId(productId);
			newProduct.setPname(name);
			newProduct.setUnitPrice(price);
			newProduct.setDescription(description);
			newProduct.setManufacturer(manufacturer);
			newProduct.setCategory(category);
		 	newProduct.setUnitsInStock(stock); 
			newProduct.setCondition(condition);
			newProduct.setFilename(fileName);
			
			dto.addProduct(newProduct);
			
			response.sendRedirect("products.jsp");
		%>
